<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Content Manager</title>
		<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
	</head>
	<body>
		<!-- Include the script that builds the page and powers Netlify CMS -->
		<script src="https://unpkg.com/netlify-cms@2.9.7/dist/netlify-cms.js"></script>
		<script>
			CMS.registerEditorComponent({
				// Internal id of the component
				id: "image",
				// Visible label
				label: "cloudinary",
				// Fields the user need to fill out when adding an instance of the component
				fields: [
					{
						name: "image",
						label: "Image",
						widget: "image",
						media_library: {
							name: "cloudinary",
							allow_multiple: false,
							output_filename_only: true,
						},
					},
					{
						name: "alt",
						label: "Alt Text",
						widget: "string",
					},
				],
				// Pattern to identify a block as being an instance of this component
				pattern: /^!\[(.*)\]\((.*?)(\s"(.*)")?\)$/,
				// Function to extract data elements from the regexp match
				fromBlock: function (match) {
					return {
						image: match[2],
						alt: match[1],
						/* title: match[4], */
					};
				},
				// make this in a way that i can find and replace later on because this gets stringify then parsed to html or something
				toBlock: function (obj) {
					const width = 500;
					return `<div><img src=${`https://res.cloudinary.com/sgrvl/w_${width}/${obj.image}`} alt=${
						obj.alt
					} /></div>`;
					//return `![${obj.alt || ""}](${obj.image || ""})`;
				},
				toPreview: function (obj) {
					return `<div><img src=${`https://res.cloudinary.com/sgrvl/w_${width}/${obj.image}`} alt=${
						obj.alt
					} /></div>`;
				},
			});
		</script>
	</body>
</html>
